<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全能汉字笔画描红生成器 (80%大小版)</title>
    <style>
        :root {
            --grid-color: #d81e06;
            /* --- 修改处：大小调整为 15mm (原18mm) --- */
            --grid-size: 15mm;     
            --trace-color: #e8e8e8;
            --font-family: "DFKaiShu-GB5", "AR PL UKai CN", "AR PL UKai", "KaiTi", "STKaiti", "楷体", serif;
        }

        body { margin: 0; padding: 0; background-color: #f5f5f5; font-family: sans-serif; }

        /* --- 控制面板 --- */
        .controls {
            background: white; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            max-width: 900px; margin: 20px auto; border-radius: 8px;
        }
        .controls h2 { margin-top: 0; color: #333; }
        
        .panel-section { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .category-title { font-size: 14px; color: #d81e06; font-weight: bold; margin: 10px 0 5px 0; }
        
        /* 笔画按钮容器 */
        .stroke-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 6px;
        }
        .stroke-btn {
            background: #fff; border: 1px solid #ddd; border-radius: 4px;
            padding: 4px; cursor: pointer; text-align: center; transition: all 0.2s;
        }
        .stroke-btn:hover { background: #eef; border-color: #aaf; transform: scale(1.05); }
        .stroke-btn span.s-char { display: block; font-family: var(--font-family); font-size: 22px; color: #333; height: 30px; line-height: 30px;}
        .stroke-btn span.s-name { display: block; font-size: 11px; color: #888; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }

        textarea { width: 100%; height: 80px; padding: 8px; border: 1px solid #ccc; font-family: var(--font-family); font-size: 18px; }
        
        .action-bar { text-align: right; margin-top: 20px; position: sticky; bottom: 0; background: white; padding: 10px 0; border-top: 2px solid #eee; }
        button { padding: 10px 20px; font-size: 16px; border-radius: 4px; cursor: pointer; border: none; margin-left: 10px; }
        button.main { background-color: #2c3e50; color: white; }
        button.print { background-color: #d81e06; color: white; }
        button.clear { background-color: white; border: 1px solid #ccc; color: #666; padding: 5px 10px; font-size: 12px;}

        /* --- A4 纸张 --- */
        .page {
            width: 210mm; min-height: 297mm; padding: 15mm 10mm; margin: 20px auto;
            background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative; display: flex; flex-direction: column; box-sizing: border-box;
        }
        .header {
            display: flex; justify-content: space-between; margin-bottom: 8mm;
            font-family: var(--font-family); border-bottom: 2px solid var(--grid-color);
        }
        /* --- 修改处：增加了 justify-content: center 让缩小后的格子居中显示 --- */
        .row { display: flex; margin-bottom: 3mm; gap: 2mm; justify-content: center; }
        
        .tianzige {
            width: var(--grid-size); height: var(--grid-size); border: 1px solid var(--grid-color);
            position: relative; display: flex; align-items: center; justify-content: center;
        }
        .tianzige::before {
            content: ''; position: absolute; top: 50%; left: 0; right: 0; border-top: 1px dashed var(--grid-color); transform: translateY(-50%);
        }
        .tianzige::after {
            content: ''; position: absolute; left: 50%; top: 0; bottom: 0; border-left: 1px dashed var(--grid-color); transform: translateX(-50%);
        }
        .char { font-family: var(--font-family); font-size: calc(var(--grid-size) * 0.75); z-index: 1; }
        .black { color: #000; }
        .trace { 
                 color: #000000;  /* 基础色设为纯黑 */
                 opacity: 0.35;   /* 关键在这里：设置15%的不透明度 */
                }

        @media print {
            body { background: white; margin: 0; }
            .controls { display: none; }
            .page { margin: 0; box-shadow: none; page-break-after: always; height: 297mm; }
        }
    </style>
</head>
<body>

    <div class="controls">
        <h2>全能硬笔书法字帖 (80%大小版)</h2>

        <!-- 笔画选择面板 -->
        <div class="panel-section">
            <label>笔画库（点击添加到下方）：</label>
            
            <div class="category-title">一、基础笔画</div>
            <div class="stroke-grid" id="group-basic"></div>

            <div class="category-title">二、折笔与钩法</div>
            <div class="stroke-grid" id="group-hook"></div>

            <div class="category-title">三、复杂复合笔画</div>
            <div class="stroke-grid" id="group-complex"></div>
        </div>

        <!-- 输入区 -->
        <div class="panel-section">
            <div style="display:flex; justify-content:space-between;">
                <label>模式1：笔画 + 范字</label>
                <button class="clear" onclick="document.getElementById('mode1Input').value=''">清空</button>
            </div>
            <textarea id="mode1Input">㇕,口
乚,礼
㇈,九
㇋,及</textarea>
        </div>

        <div class="panel-section">
            <label>模式2：整字练习</label>
            <textarea id="mode2Input" placeholder="输入汉字...">永和九年</textarea>
        </div>

        <div class="action-bar">
            <button class="main" onclick="generate()">生成预览</button>
            <button class="print" onclick="window.print()">打印 / 保存PDF</button>
        </div>
    </div>

    <div id="print-area"></div>

    <script>
        // 完整的 Unicode CJK Strokes 数据
        const strokeData = {
            basic: [
                { name: "点", char: "丶", ex: "主" },
                { name: "横", char: "一", ex: "三" },
                { name: "竖", char: "丨", ex: "中" },
                { name: "撇", char: "丿", ex: "人" },
                { name: "捺", char: "㇏", ex: "大" },
                { name: "提", char: "㇀", ex: "冰" },
                { name: "竖撇", char: "㇒", ex: "月" }
            ],
            hook: [
                { name: "横钩", char: "㇖", ex: "买" },
                { name: "横折钩", char: "㇆", ex: "羽" },
                { name: "竖钩", char: "亅", ex: "小" },
                { name: "竖提", char: "㇙", ex: "长" },
                { name: "弯钩", char: "㇁", ex: "家" },
                { name: "卧钩", char: "㇃", ex: "心" },
                { name: "斜钩", char: "㇂", ex: "我" },
                { name: "竖弯", char: "㇄", ex: "四" }
            ],
            complex: [
                { name: "竖弯钩", char: "乚", ex: "礼" },
                { name: "横折", char: "㇕", ex: "口" },
                { name: "竖折", char: "㇗", ex: "山" },
                { name: "撇折", char: "㇜", ex: "去" },
                { name: "撇点", char: "㇛", ex: "女" },
                { name: "横折提", char: "㇊", ex: "计" },
                { name: "横折弯", char: "㇍", ex: "投" },
                { name: "横折弯钩", char: "㇈", ex: "九" },
                { name: "横撇弯钩", char: "㇌", ex: "陈" },
                { name: "横折折", char: "㇅", ex: "凹" },
                { name: "横折折撇", char: "㇋", ex: "及" },
                { name: "竖折折", char: "㇞", ex: "鼎" },
                { name: "竖折折钩", char: "㇉", ex: "弓" },
                { name: "横折折折", char: "㇎", ex: "凸" },
                { name: "横折折折钩", char: "㇡", ex: "乃" }
            ]
        };

        function initControls() {
            renderGroup('group-basic', strokeData.basic);
            renderGroup('group-hook', strokeData.hook);
            renderGroup('group-complex', strokeData.complex);
        }

        function renderGroup(id, list) {
            const container = document.getElementById(id);
            list.forEach(s => {
                const btn = document.createElement('div');
                btn.className = 'stroke-btn';
                btn.innerHTML = `<span class="s-char">${s.char}</span><span class="s-name">${s.name}</span>`;
                btn.onclick = () => addStroke(s.char, s.ex);
                container.appendChild(btn);
            });
        }

        function addStroke(char, ex) {
            const input = document.getElementById('mode1Input');
            const val = input.value;
            const prefix = (val === '' || val.endsWith('\n')) ? '' : '\n';
            input.value += `${prefix}${char},${ex}`;
        }

        function createBox(text, type) {
            const box = document.createElement('div');
            box.className = 'tianzige';
            if (text && text.trim()) {
                const span = document.createElement('span');
                span.className = `char ${type}`;
                span.textContent = text;
                box.appendChild(span);
            }
            return box;
        }

        function generate() {
            const printArea = document.getElementById('print-area');
            printArea.innerHTML = '';
            
            const createNewPage = () => {
                const p = document.createElement('div');
                p.className = 'page';
                p.innerHTML = `
                    <div class="header">
                        <div>姓名：__________</div>
                        <div>日期：__________</div>
                        <div>评分：☆☆☆☆☆</div>
                    </div>`;
                return p;
            };

            let currentPage = createNewPage();
            printArea.appendChild(currentPage);
            let rows = 0;
            // --- 修改处：格子变小后，每页可以放 13 行 ---
            const limit = 13; 

            // --- 模式 1 (1黑 + 5灰 + 3汉字) ---
            const m1Text = document.getElementById('mode1Input').value;
            m1Text.split('\n').forEach(line => {
                if(!line.trim()) return;
                const parts = line.replace('，', ',').split(',');
                if(parts.length < 2) return;

                if(rows >= limit) {
                    currentPage = createNewPage();
                    printArea.appendChild(currentPage);
                    rows = 0;
                }

                const s = parts[0].trim();
                const w = parts[1].trim()[0] || '';
                
                const div = document.createElement('div');
                div.className = 'row';
                // 1范 + 5灰 (笔画)
                div.appendChild(createBox(s, 'black'));
                for(let i=0; i<5; i++) div.appendChild(createBox(s, 'trace'));
                // 3灰 (汉字)
                for(let i=0; i<3; i++) div.appendChild(createBox(w, 'trace'));
                
                currentPage.appendChild(div);
                rows++;
            });

            // --- 模式 2 (整字) ---
            const m2Text = document.getElementById('mode2Input').value;
            const chars = m2Text.split('').filter(c=>c.trim());
            chars.forEach(c => {
                if(rows >= limit) {
                    currentPage = createNewPage();
                    printArea.appendChild(currentPage);
                    rows = 0;
                }
                const div = document.createElement('div');
                div.className = 'row';
                div.appendChild(createBox(c, 'black'));
                for(let i=0; i<8; i++) div.appendChild(createBox(c, 'trace'));
                currentPage.appendChild(div);
                rows++;
            });
        }

        window.onload = () => {
            initControls();
            generate();
        };
    </script>
</body>
</html>